---
- package: Python Programming Language 
  name: Python 
  category: programming language
  common_name: python
  version: "{{ pkg_defaults.python_version }}"
  family_version: "{{ pkg_defaults.python_family }}"
  major_version: "{{ pkg_defaults.python_major }}"
  extension: tgz
  pkgname: "{{ common_name }}_{{ version }}"
  vendor_source: https://www.python.org/ftp/python/{{ version }}/Python-{{ version }}.tgz
  description: >
    Python version {{ version }}. 
  root: "{{ pkg_defaults.app_path }}/{{ name }}/{{ version }}"

  build:
    configure_args: --enable-shared  --enable-loadable-sqlite-extensions --enable-ipv6 {{ pkg_defaults.pipopts }}
    modules: 
    target: 
  install:
    makeinstall: $(MAKE) DESTDIR=$(ROOT) altinstall 
    installextra: >
      $(INSTALL) -m 644  README* $(ROOT)/{{ root }};
      cd $(ROOT)/{{ root }}/bin;
      ln -s python{{ family_version }} python{{ major_version }};
      ln -s python{{ family_version }}-config python{{ major_version }}-config

  # Some items specific to RPM packaging. Use just-compiled python to compile
  # python files. No automatic dependency and provides
  rpm:
    extras:
      - "AutoReqProv: no\\nProvides: libpython{{ family_version }}m.so.1.0()(64bit)"
      - "%define _python_bytecompile_errors_terminate_build 0"
      - "%define __python %{buildroot}/$(PKGROOT)/bin/python{{ major_version }}"
      - | 
        %define __spec_install_post \
        %{?__debug_package:%{__debug_install_post}}\
        export LD_LIBRARY_PATH=%{buildroot}/$(PKGROOT)/lib:$$LD_LIBRARY_PATH;\
        %{__arch_install_post}\
        %{__os_install_post}\
        %{nil} 
  files:
   - "{{ root }}"
